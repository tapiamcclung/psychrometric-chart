<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart 7.4</title>
    <!-- JavaScript libraries -->
    <script type="text/javascript" src="./libraries/d3.min.js"></script>
    <!-- epw data → json -->
    <script type="text/javascript" src="./jscripts/epwJson.js"></script>
    <style>
       body {
        font-family: "Segoe UI";
        background-color: rgba(192, 245, 227, 0.205);
       }
      .chartPosition {
        /* height: calc(90vh - 40px); */
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .chartBox {
        padding: 5px;
        border-radius: 10px;
        border: double 3px rgb(60, 138, 190);
        background: white;
      }
        #chartdiv {
          width: 60rem;
          height: 700px;
          margin: auto;
        }
    </style>
</head>


<body>
    <h1 style="text-align: center;"> Psychrometric Chart 7.4 </h1>
    <div>
        <label>Seleccione un archivo .epw:</label>
        <input type="file" id="fileinput" style="width: 200px;">
    </div>

    <div class="chartPosition">
        <div class="chartBox">
            <h2 id="stationName" style="text-align: center;"></h2>
            <div id="chartdiv"></div>
        </div>
    </div>
    

    
<!-- --------------------------------------------------------------- -->
<!-- ------------------------ S C R I P T S ------------------------ -->
<!-- --------------------------------------------------------------- -->

    <!-- Resources -->
    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>

    <!-- Chart code -->
 <script>
        am5.ready(function() {

        // Create root element
        // https://www.amcharts.com/docs/v5/getting-started/#Root_element
        let root = am5.Root.new("chartdiv");


        // Set themes   // https://www.amcharts.com/docs/v5/concepts/themes/
        root.setThemes([
        am5themes_Animated.new(root)
        ]);


        // Create chart     // https://www.amcharts.com/docs/v5/charts/xy-chart/
        let chart = root.container.children.push(
            am5xy.XYChart.new(root, {
            panX: true, // custom 'zoom' and 'pan'
            panY: true,
            wheelX: "panX",
            wheelY: "zoomXY",
            layout: root.verticalLayout,
            paddingLeft: 5,
            paddingRight: 5,
            })
        );


        // Color fill 100%
        chart.set("colors", am5.ColorSet.new(root, {
            step: 1,
            colors: [
                am5.color(0xffffff), // White space 100%
            ]
        }))


        // Data Lines 100% - 10% 
        const porcentajes = [{
            ax: 0, ay: 0.4,     // 10%
            bx: 0, by: 0.8,     // 20%
            cx: 0, cy: 1.2,     // 30%
            dx: 0, dy: 1.5,     // 40%
            ex: 0, ey: 1.9,     // 50%
            fx: 0, fy: 2.3,     // 60%
            gx: 0, gy: 2.7,     // 70%
            hx: 0, hy: 3,       // 80%
            ix: 0, iy: 3.4,     // 90%
            jx: 0, jy: 3.7,     // COLOR FILL 100%
        },
        {
            ax: 25, ay: 2,      // 10%
            bx: 25, by: 4,      // 20%
            cx: 25, cy: 6.05,   // 30%
            dx: 25, dy: 8.05,   // 40%
            ex: 25, ey: 10.05,  // 50%
            fx: 25, fy: 12.1,   // 60%
            gx: 25, gy: 14.1,   // 70%
            hx: 25, hy: 16,     // 80%
            ix: 25, iy: 18.1,   // 90%
            jx: 25, jy: 20,     // 100%
        },
        {
            ax: 40, ay: 4.9,    // 10%
            bx: 40, by: 9.8,    // 20%
            cx: 40, cy: 14.6,   // 30%
            dx: 40, dy: 19.55,  // 40%
            ex: 40, ey: 24.4,   // 50%
            fx: 40, fy: 29.3,   // 60%
            gx: 35, gy: 25.6,   // 70%
            hx: 35, hy: 29.25,  // 80%
            ix: 35, iy: 32.9,   // 90%
            jx: 30, jy: 26.7,   // 100%
        },
        {
            ax: 50, ay: 8.6,     // 10%
            bx: 50, by: 17.3,    // 20%
            cx: 50, cy: 25.9,    // 30%
            dx: 50, dy: 34.5,    // 40%
            ex: 46.3, ey: 35,    // 50%
            fx: 43.1, fy: 35,    // 60%
            gx: 40.4, gy: 35,    // 70%
            hx: 38.07, hy: 35,   // 80%
            ix: 36.1, iy: 35,    // 90%
            jx: 34.3, jy: 35,    // 100%
        }
        ];


        
            // Create axes  HR        
        let xAxisHR = chart.xAxes.push(
            am5xy.ValueAxis.new(root, {
                min: 0, // Custom min limit
                max: 50, // Custom max limit
                strictMinMax: true,
                maxDeviation: 0,
                renderer: am5xy.AxisRendererX.new(root, {
                    minGridDistance: 50,
                }),
                tooltip: am5.Tooltip.new(root, {
                    themeTags: ["axis"],
                    animationDuration: 300,
                }),
            })
        );

        xAxisHR.children.push(am5.Label.new(root, {
            textAlign: 'center',
            text: 'Dry Bulb Temperature (°C)',
            x: am5.p50,
        }));


        let yAxisHR = chart.yAxes.push(
            am5xy.ValueAxis.new(root, {
                min: 0, // Custom min limit
                max: 35, // Custom max limit
                strictMinMax: true,
                maxDeviation: 0,
                renderer: am5xy.AxisRendererY.new(root, {
                    opposite: true,     // eje 'Y' a la derecha
                }),
                tooltip: am5.Tooltip.new(root, {
                    themeTags: ["axis"],
                    animationDuration: 300
                })
            })
        );

        yAxisHR.children.push(
            am5.Label.new(root, {
                textAlign: 'center',
                text: 'Absolute Humidity (g/kg)',
                rotation: 90,
                y: am5.p50,
            })
        );




        // Create axes  CUADROS       // https://www.amcharts.com/docs/v5/charts/xy-chart/axes/
        /*----------- x -----------*/
        let xRenderer = am5xy.AxisRendererX.new(root, {
            strokeOpacity: 0.2,
            minGridDistance: 80,
            minorGridEnabled:true,
        });

         xRenderer.grid.template.setAll({
                location: 0,
         });

         xRenderer.labels.template.set("forceHidden", true);
        

        let xAxis = chart.xAxes.push(
            am5xy.CategoryAxis.new(root, {
                categoryField: "x",
                strictMinMax: true,
                maxDeviation: 0,
                renderer: xRenderer,
            })
        );


         /*----------- y -----------*/
        let yRenderer = am5xy.AxisRendererY.new(root, {
            strokeOpacity: 0.2,
            minGridDistance: 80,
            minorGridEnabled:true,
            opposite: true,     // eje 'Y' a la derecha
        });
        
        yRenderer.grid.template.setAll({
            location: 0
        })
        
        yRenderer.labels.template.set("forceHidden", true);


        let yAxis = chart.yAxes.push(
            am5xy.CategoryAxis.new(root, {
                // categoryField: "y",
                strictMinMax: true,
                maxDeviation: 0,
                renderer: yRenderer,
            })
        );



        // LIMIT AXIS 'X'
        xAxis.data.setAll([
            // { x:"-10" }, { x:"-9" }, { x:"-8" }, { x:"-7" }, { x:"-6" }, { x:"-5" }, { x:"-4" }, { x:"-3" }, { x:"-2" }, {x:"-1"},
            // numeros positivos
            { x:"1" }, { x:"2" }, { x:"3" }, { x:"4" }, { x:"5" }, { x:"6" }, { x:"7" }, { x:"8" }, { x:"9" }, {x:"10"},
            { x:"11" }, { x:"12" }, { x:"13" }, { x:"14" }, { x:"15" }, { x:"16" }, { x:"17" }, { x:"18" }, { x:"19" }, {x:"20"},
            { x:"21" }, { x:"22" }, { x:"23" }, { x:"24" }, { x:"25" }, { x:"26" }, { x:"27" }, { x:"28" }, { x:"29" }, {x:"30"},
            { x:"31" }, { x:"32" }, { x:"33" }, { x:"34" }, { x:"35" }, { x:"36" }, { x:"37" }, { x:"38" }, { x:"39" }, {x:"40"},
            { x:"41" }, { x:"42" }, { x:"43" }, { x:"44" }, { x:"45" }, { x:"46" }, { x:"47" }, { x:"48" }, { x:"49" }, {x:"50"},
        ]);
        // LIMIT AXIS 'Y'
        yAxis.data.setAll([
            { y:"1" }, { y:"2" }, { y:"3" }, { y:"4" }, { y:"5" }, { y:"6" }, { y:"7" }, { y:"8" }, { y:"9" }, { y:"10" },
            { y:"11" }, { y:"12" }, { y:"13" }, { y:"14" }, { y:"15" }, { y:"16" }, { y:"17" }, { y:"18" }, { y:"19" }, { y:"20" },
            { y:"21" }, { y:"22" }, { y:"23" }, { y:"24" }, { y:"25" }, { y:"26" }, { y:"27" }, { y:"28" }, { y:"29" }, { y:"30" },
            { y:"31" }, { y:"32" }, { y:"33" }, { y:"34" }, { y:"35" }, 
        ]);



        // Add series CUADROS coloreados
        function makeSeries(cuadros) {
            let series = chart.series.push(
                am5xy.ColumnSeries.new(root, {
                    name: cuadros,
                    xAxis: xAxis,
                    yAxis: yAxis,
                    categoryYField: "y",
                    openCategoryYField: "y",
                    categoryXField: "x",
                    openCategoryXField: "x",
                    clustered: false,
                })
            );
            
            series.columns.template.setAll({
                width: am5.percent(95),
                height: am5.percent(95),
                stroke: am5.color(0xffffff), //color borde a cuadro a colorear
            });
            
            series.appear();
            legend.data.push(series);
            
            return series;
        };
    
       

        // CREATE SERIES (Humedad Relativa %)
        ///////////////////////// 10% ///////////////////////
        let series10 = chart.series.push(
            am5xy.SmoothedXLineSeries.new(root, {
                xAxis: xAxisHR,
                yAxis: yAxisHR,
                valueYField: "ay",
                valueXField: "ax",
                baseAxis: xAxisHR,
                stroke: am5.color(0x767d84), // Color Line
                tooltip: am5.Tooltip.new(root, {
                labelText: "x:{valueX}, y:{valueY}"
                })
            })
        );
        // ----- Line Style -----
        series10.strokes.template.setAll({
                strokeDasharray: [3, 2],
                strokeWidth: 1,
                strokeOpacity: 0.7,
        });


        ///////////////////////// 20% ///////////////////////
        let series20 = chart.series.push(
            am5xy.SmoothedXLineSeries.new(root, {
                xAxis: xAxisHR,
                yAxis: yAxisHR,
                valueYField: "by",
                valueXField: "bx",
                baseAxis: xAxisHR,
                stroke: am5.color(0x767d84), // Color Line
                tooltip: am5.Tooltip.new(root, {
                labelText: "x:{valueX}, y:{valueY}"
                })
            })
        );
        // ----- Line Style -----
        series20.strokes.template.setAll({
                strokeDasharray: [3, 2],
                strokeWidth: 1,
                strokeOpacity: 0.7,
        });


        ///////////////////////// 30% ///////////////////////
        let series30 = chart.series.push(
            am5xy.SmoothedXLineSeries.new(root, {
                xAxis: xAxisHR,
                yAxis: yAxisHR,
                valueYField: "cy",
                valueXField: "cx",
                baseAxis: xAxisHR,
                stroke: am5.color(0x767d84), // Color Line
                tooltip: am5.Tooltip.new(root, {
                labelText: "x:{valueX}, y:{valueY}"
                })
            })
        );
        // ----- Line Style -----
        series30.strokes.template.setAll({
                strokeDasharray: [3, 2],
                strokeWidth: 1,
                strokeOpacity: 0.7,
        });


        ///////////////////////// 40% ///////////////////////
        let series40 = chart.series.push(
            am5xy.SmoothedXLineSeries.new(root, {
                xAxis: xAxisHR,
                yAxis: yAxisHR,
                valueYField: "dy",
                valueXField: "dx",
                baseAxis: xAxisHR,
                stroke: am5.color(0x767d84), // Color Line
                tooltip: am5.Tooltip.new(root, {
                labelText: "x:{valueX}, y:{valueY}"
                })
            })
        );
        // ----- Line Style -----
        series40.strokes.template.setAll({
                strokeDasharray: [3, 2],
                strokeWidth: 1,
                strokeOpacity: 0.7,
        });


        ///////////////////////// 50% ///////////////////////
        let series50 = chart.series.push(
            am5xy.SmoothedXLineSeries.new(root, {
                xAxis: xAxisHR,
                yAxis: yAxisHR,
                valueYField: "ey",
                valueXField: "ex",
                baseAxis: xAxisHR,
                stroke: am5.color(0x767d84), // Color Line
                tooltip: am5.Tooltip.new(root, {
                labelText: "x:{valueX}, y:{valueY}"
                })
            })
        );
        // ----- Line Style -----
        series50.strokes.template.setAll({
                strokeDasharray: [3, 2],
                strokeWidth: 1,
                strokeOpacity: 0.7,
        });

        
        ///////////////////////// 60% ///////////////////////
        let series60 = chart.series.push(
            am5xy.SmoothedXLineSeries.new(root, {
                xAxis: xAxisHR,
                yAxis: yAxisHR,
                valueYField: "fy",
                valueXField: "fx",
                baseAxis: xAxisHR,
                stroke: am5.color(0x767d84), // Color Line
                tooltip: am5.Tooltip.new(root, {
                labelText: "x:{valueX}, y:{valueY}"
                })
            })
        );
        // ----- Line Style -----
        series60.strokes.template.setAll({
                strokeDasharray: [3, 2],
                strokeWidth: 1,
                strokeOpacity: 0.7,
        });


        ///////////////////////// 70% ///////////////////////
        let series70 = chart.series.push(
            am5xy.SmoothedXLineSeries.new(root, {
                xAxis: xAxisHR,
                yAxis: yAxisHR,
                valueYField: "gy",
                valueXField: "gx",
                baseAxis: xAxisHR,
                stroke: am5.color(0x767d84), // Color Line
                tooltip: am5.Tooltip.new(root, {
                labelText: "x:{valueX}, y:{valueY}"
                })
            })
        );
        // ----- Line Style -----
        series70.strokes.template.setAll({
                strokeDasharray: [3, 2],
                strokeWidth: 1,
                strokeOpacity: 0.7,
        });


        ///////////////////////// 80% ///////////////////////
        let series80 = chart.series.push(
            am5xy.SmoothedXLineSeries.new(root, {
                xAxis: xAxisHR,
                yAxis: yAxisHR,
                valueYField: "hy",
                valueXField: "hx",
                baseAxis: xAxisHR,
                stroke: am5.color(0x767d84), // Color Line
                tooltip: am5.Tooltip.new(root, {
                labelText: "x:{valueX}, y:{valueY}"
                })
            })
        );
        // ----- Line Style -----
        series80.strokes.template.setAll({
                strokeDasharray: [3, 2],
                strokeWidth: 1,
                strokeOpacity: 0.7,
        });


        ///////////////////////// 90% ///////////////////////
        let series90 = chart.series.push(
            am5xy.SmoothedXLineSeries.new(root, {
                xAxis: xAxisHR,
                yAxis: yAxisHR,
                valueYField: "iy",
                valueXField: "ix",
                baseAxis: xAxisHR,
                stroke: am5.color(0x767d84), // Color Line
                tooltip: am5.Tooltip.new(root, {
                labelText: "x:{valueX}, y:{valueY}"
                })
            })
        );
        // ----- Line Style -----
        series90.strokes.template.setAll({
                strokeDasharray: [3, 2],
                strokeWidth: 1,
                strokeOpacity: 0.7,
        });

        
        /////////////////////// 100% ///////////////////////
        let series100 = chart.series.push(
            am5xy.SmoothedXLineSeries.new(root, {  // SmoothedXLineSeries - hace línea curva
                xAxis: xAxisHR,
                yAxis: yAxisHR,
                valueYField: "jy",
                valueXField: "jx",
                baseAxis: yAxisHR,
                stroke: am5.color(0x767d84), // Color Line
                tooltip: am5.Tooltip.new(root, {
                labelText: "x:{valueX}, y:{valueY}"
                })
            })
        );
        // ----- Line Style -----
        series100.strokes.template.setAll({
        strokeWidth: 1.5, 
        strokeOpacity: 0.7,
        });
        // ----- Fill Space -----
        series100.fills.template.setAll({
            fillOpacity: 5,
            visible: true,
        });

    
// --------------------------------- READ FILE ---------------------------------
// código extraido de la pag: https://web.dev/articles/read-files?hl=es

    function readSingleFile(file) {
            var f = file;
            if (f) {
            var r = new FileReader();
            r.onloadstart = function(e) {
                document.getElementById('fileinput').innerHTML = "parsing file...";
            };
            r.onload = function(e) { // lo lee como archivo
                var contents = e.target.result;
                var raw = r.result;
                
                epw = epwJson(raw); // parsea el archivo epw de json object
                
            console.log(epw); // monitoreo de archivos en consola

            document.getElementById('stationName').innerHTML = "Chart for " + epw.stationLocation;
            document.getElementById('year').innerHTML = "Año: " + epw.year;
            };
            r.readAsText(f);
            } else { 
            alert("Failed to load file");
            }
    };

    fileInput = document.getElementById('fileinput'); //obtiene el archivo
        
    fileInput.onchange = function(evt) {
        readSingleFile(evt.target.files[0]);
    };    
        

        //  SHOW ALL CHART
        series10.data.setAll(porcentajes);
        series20.data.setAll(porcentajes);
        series30.data.setAll(porcentajes);
        series40.data.setAll(porcentajes);
        series50.data.setAll(porcentajes);
        series60.data.setAll(porcentajes);
        series70.data.setAll(porcentajes);
        series80.data.setAll(porcentajes);
        series90.data.setAll(porcentajes);
        series100.data.setAll(porcentajes);
        
        // Make stuff animate on load
        // https://www.amcharts.com/docs/v5/concepts/animations/
        chart.appear(1000, 100);

        }); // end am5.ready()
 </script>
</body>
</html>